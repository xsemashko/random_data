function exportToExcel() {
    const table = document.getElementById("data-table");
    
    // Создаем массив для данных таблицы
    const data = [];
    
    // Проходим по всем строкам таблицы
    const rows = table.querySelectorAll("tr");
    rows.forEach((row, rowIndex) => {
        const rowData = [];
        const cells = row.querySelectorAll("th, td");
        
        cells.forEach((cell, cellIndex) => {
            // Если это первый столбец (индекс 0), форматируем значение как текст
            if (cellIndex === 0 && rowIndex > 0) { // Пропускаем заголовок
                rowData.push({ t: 's', v: cell.innerText }); // 's' означает строку (текст)
            } else {
                rowData.push(cell.innerText);
            }
        });
        
        data.push(rowData);
    });
    
    // Создаем рабочий лист Excel
    const worksheet = XLSX.utils.aoa_to_sheet(data);
    
    // Создаем книгу и добавляем рабочий лист
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
    
    // Создаем бинарный файл Excel
    const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
    
    // Форматируем текущую дату и время
    const now = new Date();
    const formattedDate = `${String(now.getDate()).padStart(2, '0')}_${
        String(now.getMonth() + 1).padStart(2, '0')}_${
        now.getFullYear()}_${
        String(now.getHours()).padStart(2, '0')}_${
        String(now.getMinutes()).padStart(2, '0')}_${
        String(now.getSeconds()).padStart(2, '0')}`;
    
    // Сохраняем файл с именем, содержащим дату и время
    saveAsExcelFile(excelBuffer, `Результаты_запроса_${formattedDate}.xlsx`);
}

function saveAsExcelFile(buffer, filename) {
    const blob = new Blob([buffer], { type: 'application/octet-stream' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
    setTimeout(() => {
        URL.revokeObjectURL(link.href);
    }, 100);
}
