import concurrent.futures

def mq_putter(mp_queue, log_queue):
    MQP = MQWorkerPUT(log_queue)
    
    with concurrent.futures.ThreadPoolExecutor(max_workers=1) as executor:
        while True:
            present_to_put = 0
            try:
                mp_item_rs = mp_queue.get_nowait()
                root, od, put_mqmd, put_opts, put_rfh2, RECORD_ID, RQUID = mp_item_rs
                present_to_put = 1
            except:
                time.sleep(0.0001)

            if present_to_put == 1:
                future = executor.submit(
                    MQP.put_to_queue, 
                    root, od, put_mqmd, put_opts, put_rfh2, RECORD_ID, RQUID, log_queue
                )
                
                try:
                    future.result(timeout=5)  # Таймаут 5 секунд
                    log_queue.put(['DEBUG', root.toprettyxml()])
                    log_queue.put(['INFO', f"Message sent: [{RECORD_ID}] [MQ] RQUID = {RQUID}"])
                except concurrent.futures.TimeoutError:
                    log_queue.put(['ERROR', f'Time out occurred while sending [{RECORD_ID}] to MQ'])
                except Exception as e:
                    log_queue.put(['ERROR', f'Error while sending [{RECORD_ID}]: {str(e)}'])
